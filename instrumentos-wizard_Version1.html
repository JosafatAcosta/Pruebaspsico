<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Wizard de Instrumentos — BDI-II · EGEP-5 · AMAS-A · IDARE</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--brand:#217293;--muted:#777;--card-bg:#fff;--page-bg:#f8f8fa}
    body {font-family: Arial, sans-serif; background:var(--page-bg); padding:20px; margin:0;}
    .wrap {max-width:1100px; margin:18px auto; display:grid; grid-template-columns:260px 1fr; gap:18px; align-items:start;}
    .menu {background:var(--card-bg); padding:16px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.06);}
    .menu h2{margin:0 0 8px; color:var(--brand);}
    .menu button{display:block; width:100%; text-align:left; margin:8px 0; padding:10px 12px; border-radius:6px; border:1px solid #e6eef0; background:#f7fbfc; cursor:pointer;}
    .menu button.active{background:var(--brand); color:#fff; border-color:var(--brand);}
    .content {background:var(--card-bg); padding:18px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.06);}
    .instr {display:none;}
    .instr.active{display:block;}
    h1,h3{color:var(--brand); margin:0 0 10px;}
    label{display:block;margin-top:12px;font-weight:600;}
    input[type=number], select, textarea{padding:8px;border:1px solid #ddd;border-radius:6px;width:100%;box-sizing:border-box;margin-top:6px;}
    .controls {margin-top:12px;}
    .controls button{background:var(--brand); color:#fff; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; margin-right:8px;}
    .controls button.secondary{background:#f0f0f0;color:#222;}
    .result{margin-top:14px;padding:12px;border:1px solid #eee;background:#fafafa;white-space:pre-wrap;}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid #eee;padding:8px;text-align:left}
    .small{font-size:0.92em;color:var(--muted)}
    .footer{font-size:0.9em;color:var(--muted);margin-top:14px;text-align:center}
    @media(max-width:900px){ .wrap{grid-template-columns:1fr} .menu{order:2} .content{order:1} }
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="menu" aria-label="Menú instrumentos">
      <h2>Selecciona instrumento</h2>
      <button data-target="bdi" id="menu-bdi">BDI-II (Beck)</button>
      <button data-target="egep" id="menu-egep">EGEP-5 (Estrés Postraumático)</button>
      <button data-target="amas" id="menu-amas">AMAS-A (Ansiedad)</button>
      <button data-target="idare" id="menu-idare">IDARE / STAI (Ansiedad)</button>
      <div class="small" style="margin-top:12px;">Selecciona uno de los instrumentos para abrirlo inmediatamente. Todos funcionan offline en el navegador.</div>
    </aside>

    <main class="content" id="mainContent">
      <!-- BDI-II -->
      <section id="bdi" class="instr" aria-hidden="true">
        <h1>BDI-II — Inventario de Depresión de Beck-II</h1>
        <label for="bdi_puntaje">Puntaje bruto total (0–63)</label>
        <input id="bdi_puntaje" type="number" min="0" max="63" placeholder="0 a 63">

        <div class="controls">
          <button id="bdi_calcular">Calcular e interpretar</button>
          <button id="bdi_cpBtn" style="display:none;" class="secondary">Copiar reporte</button>
          <button id="bdi_prBtn" style="display:none;" class="secondary">Imprimir / PDF</button>
        </div>

        <div id="bdi_resultado" class="result" aria-live="polite"></div>
        <div class="small">Adaptación española: Sanz, J., et al. (2003) — TEA Ediciones</div>
      </section>

      <!-- EGEP-5 -->
      <section id="egep" class="instr" aria-hidden="true">
        <h1>EGEP-5 — Evaluación Global de Estrés Postraumático</h1>
        <div class="small">Complete los dominios B–E con la suma de grados (0–4 por ítem) o use los valores totales del dominio.</div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:10px;">
          <div>
            <label for="egep_intrusivos">Intrusivos (B) — 0 a 20</label>
            <input id="egep_intrusivos" type="number" min="0" max="20" value="0">
          </div>
          <div>
            <label for="egep_evitacion">Evitación (C) — 0 a 8</label>
            <input id="egep_evitacion" type="number" min="0" max="8" value="0">
          </div>
          <div>
            <label for="egep_cognitivas">Cognitivas y Ánimo (D) — 0 a 28</label>
            <input id="egep_cognitivas" type="number" min="0" max="28" value="0">
          </div>
          <div>
            <label for="egep_activacion">Activación y Reactividad (E) — 0 a 24</label>
            <input id="egep_activacion" type="number" min="0" max="24" value="0">
          </div>
          <div>
            <label for="egep_disociativos">Disociativos — 0 a 12</label>
            <input id="egep_disociativos" type="number" min="0" max="12" value="0">
          </div>
          <div>
            <label for="egep_funcionamiento">Funcionamiento afectado (G) — 0 a 7</label>
            <input id="egep_funcionamiento" type="number" min="0" max="7" value="0">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:10px;">
          <div>
            <label for="egep_duracion">Duración de síntomas (F)</label>
            <select id="egep_duracion">
              <option value="">Seleccione</option>
              <option value="menos1">Menos de 1 mes</option>
              <option value="1a3">1 a 3 meses</option>
              <option value="mas3">Más de 3 meses</option>
            </select>
          </div>
          <div>
            <label for="egep_inicio">Inicio de síntomas</label>
            <select id="egep_inicio">
              <option value="">Seleccione</option>
              <option value="no">Inmediato o en ≤ 6 meses</option>
              <option value="si">> 6 meses después (expresión retardada)</option>
            </select>
          </div>
        </div>

        <div class="controls">
          <button id="egep_calcular">Calcular e interpretar</button>
          <button id="egep_cpBtn" style="display:none;" class="secondary">Copiar reporte</button>
          <button id="egep_prBtn" style="display:none;" class="secondary">Imprimir / PDF</button>
        </div>

        <div id="egep_resultado" class="result" aria-live="polite"></div>
        <div class="small" style="margin-top:8px;">Nota: la lógica diagnóstica es una aproximación basada en conteo de ítems con grado ≥2 por dominio (proxy DSM‑5).</div>
      </section>

      <!-- AMAS-A -->
      <section id="amas" class="instr" aria-hidden="true">
        <h1>AMAS-A — Adult Manifest Anxiety Scale (Adultos)</h1>
        <label for="amas_preocupacion">Preocupación / Hipersensibilidad (0–16)</label>
        <input id="amas_preocupacion" type="number" min="0" max="16" value="0">
        <label for="amas_fisiologica">Ansiedad fisiológica (0–16)</label>
        <input id="amas_fisiologica" type="number" min="0" max="16" value="0">
        <label for="amas_social">Ansiedad social / estrés (0–4)</label>
        <input id="amas_social" type="number" min="0" max="4" value="0">
        <label for="amas_mentira">Escala de mentira (0–6)</label>
        <input id="amas_mentira" type="number" min="0" max="6" value="0">

        <div class="controls">
          <button id="amas_calcular">Calcular e interpretar</button>
          <button id="amas_cpBtn" style="display:none;" class="secondary">Copiar reporte</button>
          <button id="amas_prBtn" style="display:none;" class="secondary">Imprimir / PDF</button>
        </div>

        <div id="amas_resultado" class="result" aria-live="polite"></div>
        <div class="small">Referencia: Reynolds, C. R., Richmond, B. O., & Lowe, P. A. (AMAS).</div>
      </section>

      <!-- IDARE / STAI -->
      <section id="idare" class="instr" aria-hidden="true">
        <h1>IDARE / STAI — Ansiedad Estado / Rasgo</h1>
        <label for="idare_puntajeEstado">Puntaje bruto Ansiedad Estado (0–60)</label>
        <input id="idare_puntajeEstado" type="number" min="0" max="60" value="0">
        <label for="idare_puntajeRasgo">Puntaje bruto Ansiedad Rasgo (0–60)</label>
        <input id="idare_puntajeRasgo" type="number" min="0" max="60" value="0">

        <div class="controls">
          <button id="idare_calcular">Calcular e interpretar</button>
          <button id="idare_cpBtn" style="display:none;" class="secondary">Copiar reporte</button>
          <button id="idare_prBtn" style="display:none;" class="secondary">Imprimir / PDF</button>
        </div>

        <div id="idare_resultado" class="result" aria-live="polite"></div>
        <div class="small">Nota: la conversión bruto→T aquí es aproximada. Si dispones de tablas normativas reemplázalas en la función correspondiente.</div>
      </section>
    </main>
  </div>

  <div class="footer">Wizard de instrumentos clínicos — versión consolidada. Guarda localmente y ábrelo en tu navegador. © 2025</div>

  <script>
    // ---------- Navegación: mostrar instrumento seleccionado ----------
    const menuButtons = document.querySelectorAll('.menu button');
    const instrSections = document.querySelectorAll('.instr');

    function showInstrument(id) {
      instrSections.forEach(s => {
        if (s.id === id) {
          s.classList.add('active');
          s.setAttribute('aria-hidden', 'false');
        } else {
          s.classList.remove('active');
          s.setAttribute('aria-hidden', 'true');
        }
      });
      menuButtons.forEach(b => b.classList.toggle('active', b.dataset.target === id));
      // scroll to top of content on mobile
      document.getElementById('mainContent').scrollIntoView({behavior:'smooth'});
    }

    menuButtons.forEach(btn => {
      btn.addEventListener('click', () => showInstrument(btn.dataset.target));
    });

    // Abrir el primer instrumento por defecto
    showInstrument('bdi');

    // ---------- BDI-II (namespaced) ----------
    (function(){
      const puntajeEl = document.getElementById('bdi_puntaje');
      const resEl = document.getElementById('bdi_resultado');
      const cpBtn = document.getElementById('bdi_cpBtn');
      const prBtn = document.getElementById('bdi_prBtn');

      function interpretarBDI2(puntaje) {
        if (puntaje <= 13)  return {nivel: "Mínima", color: "#2e7d32", percentil: "< 25", desc: "Depresión mínima o ausente. No se observan síntomas depresivos clínicamente relevantes."};
        if (puntaje <= 19)  return {nivel: "Leve", color: "#388e3c", percentil: "25–50", desc: "Depresión leve. Sintomatología presente pero no incapacitante. Puede beneficiarse de seguimiento o intervención preventiva."};
        if (puntaje <= 28) return {nivel: "Moderada", color: "#f9a825", percentil: "50–85", desc: "Depresión moderada. Impacto significativo en el funcionamiento diario. Recomendable evaluación y tratamiento psicológico."};
        return                     {nivel: "Severa", color: "#c62828", percentil: "≥ 85", desc: "Depresión severa. Alto riesgo de complicaciones (suicidalidad, aislamiento). Intervención urgente: terapia y posible farmacoterapia."};
      }

      function recomendacionClinica(puntaje) {
        if (puntaje >= 29) return "Depresión severa detectada. Evaluar riesgo suicida inmediatamente. Recomendar terapia cognitivo-conductual (TCC), antidepresivos y seguimiento multidisciplinar.";
        if (puntaje >= 20) return "Depresión moderada. Beneficio de TCC, psicoeducación y monitoreo de síntomas. Considerar derivación a psiquiatría si persiste.";
        if (puntaje >= 14) return "Depresión leve. Estrategias de autocuidado, actividad física y terapia breve. Monitorear evolución.";
        return "Nivel depresivo mínimo. Mantener hábitos saludables y reevaluación si hay cambios.";
      }

      document.getElementById('bdi_calcular').addEventListener('click', () => {
        const p = parseInt(puntajeEl.value,10);
        if (isNaN(p) || p < 0 || p > 63) {
          resEl.innerHTML = "<b style='color:red'>Introduce un valor entre 0 y 63</b>";
          cpBtn.style.display = 'none'; prBtn.style.display = 'none';
          return;
        }
        const interp = interpretarBDI2(p);
        const recom = recomendacionClinica(p);
        resEl.innerHTML = `
          <div><b>Puntaje total BDI-II:</b> ${p}/63</div>
          <div style="color:${interp.color};font-weight:700;margin-top:6px;">→ ${interp.nivel} (percentil ${interp.percentil})</div>
          <div style="margin-top:8px;">${interp.desc}</div>
          <div style="margin-top:12px;border-top:1px solid #eee;padding-top:10px;"><b>Interpretación e indicaciones clínicas:</b><br>${recom}</div>
          <div style="margin-top:10px;font-size:0.9em;color:var(--muted);">Referencia: Beck et al. (1996). Adaptación española: Sanz et al. (2003).</div>
        `;
        cpBtn.style.display = 'inline-block'; prBtn.style.display = 'inline-block';
      });

      cpBtn.addEventListener('click', ()=>{
        const text = resEl.innerText || resEl.textContent;
        if (navigator.clipboard) navigator.clipboard.writeText(text).then(()=>alert('Reporte copiado al portapapeles.'));
        else alert('Copiar manualmente: selecciona y copia el texto.');
      });
      prBtn.addEventListener('click', ()=> window.print());
    })();

    // ---------- EGEP-5 (namespaced) ----------
    (function(){
      const get = id => document.getElementById('egep_' + id);
      const resEl = document.getElementById('egep_resultado');
      const cpBtn = document.getElementById('egep_cpBtn');
      const prBtn = document.getElementById('egep_prBtn');

      document.getElementById('egep_calcular').addEventListener('click', () => {
        const i = parseInt(get('intrusivos').value||'0',10);
        const e = parseInt(get('evitacion').value||'0',10);
        const c = parseInt(get('cognitivas').value||'0',10);
        const a = parseInt(get('activacion').value||'0',10);
        const d = parseInt(get('disociativos').value||'0',10);
        const f = parseInt(get('funcionamiento').value||'0',10);
        const duracion = get('duracion').value;
        const inicio = get('inicio').value;

        if ([i,e,c,a,d,f].some(v=>isNaN(v)) || !duracion || !inicio) {
          resEl.innerHTML = "<b style='color:red'>Completa todos los campos (incluya duración e inicio)</b>";
          cpBtn.style.display='none'; prBtn.style.display='none';
          return;
        }

        // Totales y niveles
        const max = {B:20,C:8,D:28,E:24,DIS:12,TOTAL:80};
        const totalSymptoms = i + e + c + a;
        function nivel(score,maxScore){
          const pct = score/maxScore;
          if (pct < .2) return {nivel:'Muy bajo', color:'#2e7d32'};
          if (pct < .4) return {nivel:'Bajo', color:'#388e3c'};
          if (pct < .6) return {nivel:'Moderado', color:'#f9a825'};
          if (pct < .8) return {nivel:'Alto', color:'#ef6c00'};
          return {nivel:'Muy alto', color:'#c62828'};
        }

        // Criterios aproximados: aquí usamos umbrales por dominio (o conteo de ítems si tuvieses ítems individuales)
        const meetB = i >= 4; // umbral proxy
        const meetC = e >= 2;
        const meetD = c >= 6;
        const meetE = a >= 6;
        const meetG = f >= 1;
        const durMayor1m = duracion !== 'menos1';
        const disoc = d >= 4;
        const retardada = inicio === 'si';

        let diag = '';
        let color = '#388e3c';
        if (meetB && meetC && meetD && meetE && durMayor1m && meetG) {
          diag = 'Cumple criterios proxy para TEPT. (Aproximación automatizada)';
          color = '#c62828';
          if (disoc) diag += ' Subtipo disociativo sugerido.';
          if (retardada) diag += ' Presentación retardada.';
        } else if (!durMayor1m && meetB && meetC && meetD && meetE && meetG) {
          diag = 'Posible Trastorno de Estrés Agudo (duración <1 mes).';
          color = '#ef6c00';
        } else {
          diag = 'No cumple criterios proxy para TEPT con estos umbrales.';
          color = '#388e3c';
        }

        function recom(total) {
          if (total >= 54) return 'Probable TEPT clínicamente significativo. Evaluación y tratamiento especializados recomendados.';
          if (total >= 33) return 'Sintomatología moderada-alta. Considerar intervención psicoterapéutica.';
          if (total >= 20) return 'Sintomatología moderada. Valorar intervención breve.';
          return 'Sintomatología baja. Monitoreo.';
        }

        const nb = nivel(i,max.B), nc = nivel(e,max.C), nd = nivel(c,max.D), ne = nivel(a,max.E), nds = nivel(d,max.DIS), nt = nivel(totalSymptoms,max.TOTAL);

        const lines = [];
        lines.push('EGEP-5 — Informe aproximado');
        lines.push(`Puntajes B–E: Intrusivos ${i}/${max.B} (${nb.nivel}), Evitación ${e}/${max.C} (${nc.nivel}), Cogn/Ánimo ${c}/${max.D} (${nd.nivel}), Activación ${a}/${max.E} (${ne.nivel})`);
        lines.push(`Disociativos: ${d}/${max.DIS} (${nds.nivel})`);
        lines.push(`Total (B–E): ${totalSymptoms}/${max.TOTAL} → ${nt.nivel}`);
        lines.push('');
        lines.push(`Diagnóstico aproximado: ${diag}`);
        lines.push('');
        lines.push(`Duración: ${duracion} · Inicio retardado: ${retardada ? 'Sí' : 'No'}`);
        lines.push('');
        lines.push('Recomendación: ' + recom(totalSymptoms));
        lines.push('');
        lines.push('Nota: esta interpretación es automatizada y aproximada y no reemplaza el juicio clínico.');
        lines.push('Referencia: Crespo, Gómez & Soberón (2017). EGEP-5. TEA Ediciones.');

        resEl.textContent = lines.join('\n');
        cpBtn.style.display='inline-block'; prBtn.style.display='inline-block';
      });

      cpBtn.addEventListener('click', ()=>{
        const text = resEl.innerText || resEl.textContent;
        if (navigator.clipboard) navigator.clipboard.writeText(text).then(()=>alert('Reporte EGEP copiado al portapapeles.'));
        else alert('Copiar manualmente');
      });
      prBtn.addEventListener('click', ()=> window.print());
    })();

    // ---------- AMAS-A (namespaced) ----------
    (function(){
      const preEl = document.getElementById('amas_preocupacion');
      const fisEl = document.getElementById('amas_fisiologica');
      const socEl = document.getElementById('amas_social');
      const menEl = document.getElementById('amas_mentira');
      const resEl = document.getElementById('amas_resultado');
      const cpBtn = document.getElementById('amas_cpBtn');
      const prBtn = document.getElementById('amas_prBtn');

      function interpPre(p){
        if (p <= 4) return {nivel:"Muy baja", color:"#2e7d32", texto:"Preocupación mínima."};
        if (p <= 8) return {nivel:"Baja", color:"#388e3c", texto:"Preocupación leve y funcional."};
        if (p <= 11) return {nivel:"Media", color:"#f9a825", texto:"Preocupación moderada."};
        if (p <= 13) return {nivel:"Elevada", color:"#ef6c00", texto:"Preocupación notable."};
        return {nivel:"Muy elevada", color:"#c62828", texto:"Preocupación intensa. Requiere atención."};
      }
      function interpFis(p){
        if (p <= 3) return {nivel:"Muy baja", color:"#2e7d32", texto:"Pocas manifestaciones somáticas."};
        if (p <= 7) return {nivel:"Normal", color:"#388e3c", texto:"Síntomas leves y ocasionales."};
        if (p <= 10) return {nivel:"Moderada", color:"#f9a825", texto:"Síntomas frecuentes pero manejables."};
        return {nivel:"Alta", color:"#c62828", texto:"Importante activación fisiológica."};
      }
      function interpSoc(p){
        if (p == 0) return {nivel:"Nula", color:"#2e7d32", texto:"Sin malestar social significativo."};
        if (p <= 2) return {nivel:"Leve", color:"#7cb342", texto:"Ansiedad social leve."};
        return {nivel:"Elevada", color:"#c62828", texto:"Ansiedad social clínicamente relevante."};
      }
      function interpMent(m){
        if (m <= 2) return {val:"Válido", color:"#2e7d32", txt:"Protocolo confiable."};
        if (m <= 4) return {val:"Precaución", color:"#ef6c00", txt:"Posible minimización."};
        return {val:"Inválido", color:"#c62828", txt:"Alta deseabilidad social."};
      }
      function totalInterp(t){
        if (t <= 7) return {nivel:"Muy baja", pct:"<25", color:"#2e7d32"};
        if (t <= 14) return {nivel:"Normal", pct:"25–75", color:"#388e3c"};
        if (t <= 21) return {nivel:"Elevada", pct:"76–94", color:"#ef6c00"};
        return {nivel:"Clínica", pct:"≥95", color:"#c62828"};
      }

      document.getElementById('amas_calcular').addEventListener('click', ()=>{
        const pre = parseInt(preEl.value||'0',10);
        const fis = parseInt(fisEl.value||'0',10);
        const soc = parseInt(socEl.value||'0',10);
        const men = parseInt(menEl.value||'0',10);
        if ([pre,fis,soc,men].some(v=>isNaN(v))) {
          resEl.innerHTML = "<b style='color:red'>Completa todos los campos</b>"; cpBtn.style.display='none'; prBtn.style.display='none'; return;
        }
        const total = pre + fis + soc;
        const ipre = interpPre(pre), ifis = interpFis(fis), isoc = interpSoc(soc), imen = interpMent(men), itot = totalInterp(total);
        let integral = '';
        if (men > 2) integral = "⚠️ VALIDEZ DUDOSA – Escala de Mentira elevada. Puntajes pueden estar subestimados.";
        else if (total >= 22) integral = "Ansiedad clínicamente significativa. Recomendable evaluación y tratamiento.";
        else if (total >= 15) integral = "Ansiedad elevada. Técnicas de manejo del estrés útiles.";
        else integral = "Ansiedad dentro de rango funcional. Monitoreo si procede.";

        resEl.innerHTML = `
          Puntaje total: ${total} → <strong style="color:${itot.color}">${itot.nivel}</strong> (percentil ${itot.pct})
          \n\nPreocupación: ${pre}/16 → ${ipre.nivel}\n${ipre.texto}
          \n\nAnsiedad fisiológica: ${fis}/16 → ${ifis.nivel}\n${ifis.texto}
          \n\nAnsiedad social: ${soc}/4 → ${isoc.nivel}\n${isoc.texto}
          \n\nEscala de Mentira: ${men}/6 → ${imen.val}\n${imen.txt}
          \n\nInterpretación clínica:\n${integral}
          \n\nReferencia: Reynolds et al. (AMAS).`;
        cpBtn.style.display='inline-block'; prBtn.style.display='inline-block';
      });

      cpBtn.addEventListener('click', ()=>{
        const text = document.getElementById('amas_resultado').innerText;
        if (navigator.clipboard) navigator.clipboard.writeText(text).then(()=>alert('Reporte AMAS copiado.'));
        else alert('Copiar manualmente');
      });
      prBtn.addEventListener('click', ()=> window.print());
    })();

    // ---------- IDARE / STAI (namespaced) ----------
    (function(){
      const estadoEl = document.getElementById('idare_puntajeEstado');
      const rasgoEl = document.getElementById('idare_puntajeRasgo');
      const resEl = document.getElementById('idare_resultado');
      const cpBtn = document.getElementById('idare_cpBtn');
      const prBtn = document.getElementById('idare_prBtn');

      function calculaT_IDARE(bruto) {
        // Fórmula aproximada: T = 35 + 0.75 * bruto (ajustable)
        return Math.round(35 + bruto * 0.75);
      }
      function interpretacionEstado(t){
        if (t < 55) return {nivel:"Baja", texto:"Ansiedad-estado en niveles bajos. Sin sintomatología significativa actualmente."};
        if (t < 65) return {nivel:"Promedio", texto:"Ansiedad-estado en rango promedio; respuesta situacional normal."};
        return {nivel:"Alta", texto:"Ansiedad-estado elevada. Recomendable evaluación de desencadenantes y seguimiento."};
      }
      function interpretacionRasgo(t){
        if (t < 55) return {nivel:"Baja", texto:"Ansiedad-rasgo baja. Estabilidad emocional habitual."};
        if (t < 65) return {nivel:"Promedio", texto:"Ansiedad-rasgo promedio; ocasionalmente presenta inquietud."};
        return {nivel:"Alta", texto:"Ansiedad-rasgo elevada. Predisposición a la ansiedad sostenida; valorar intervención preventiva."};
      }
      function interpretacionIntegral(tE,tR){
        if (tE >= 65 && tR < 65) return "Reacción ansiosa aguda sin predisposición crónica. Seguimiento para identificar desencadenantes.";
        if (tE < 65 && tR >= 65) return "Predisposición ansiosa crónica sin activación actual. Trabajar en recursos y afrontamiento.";
        if (tE >= 65 && tR >= 65) return "Elevación sostenida y actual de la ansiedad. Evaluación clínica integral recomendada.";
        if (tE < 55 && tR < 55) return "Sin signos significativos de ansiedad.";
        return "Perfil en rango funcional; monitorizar según contexto.";
      }

      document.getElementById('idare_calcular').addEventListener('click', ()=>{
        const brE = parseInt(estadoEl.value||'0',10);
        const brR = parseInt(rasgoEl.value||'0',10);
        if (isNaN(brE) || isNaN(brR)) { resEl.innerHTML = "<b style='color:red'>Completa ambos campos.</b>"; cpBtn.style.display='none'; prBtn.style.display='none'; return; }
        const tE = calculaT_IDARE(brE); const tR = calculaT_IDARE(brR);
        const ie = interpretacionEstado(tE); const ir = interpretacionRasgo(tR);
        const integral = interpretacionIntegral(tE,tR);
        resEl.innerHTML = `
          Ansiedad Estado: T=${tE} → ${ie.nivel}\n${ie.texto}
          \n\nAnsiedad Rasgo: T=${tR} → ${ir.nivel}\n${ir.texto}
          \n\nInterpretación integral:\n${integral}
          \n\nNota: Conversión bruto→T aproximada. Reemplaza por tabla normativa si tienes acceso al manual.\nReferencia: Spielberger (IDARE/STAI).`;
        cpBtn.style.display='inline-block'; prBtn.style.display='inline-block';
      });

      cpBtn.addEventListener('click', ()=>{
        const text = resEl.innerText;
        if (navigator.clipboard) navigator.clipboard.writeText(text).then(()=>alert('Reporte IDARE copiado.'));
        else alert('Copiar manualmente');
      });
      prBtn.addEventListener('click', ()=> window.print());
    })();

    // Optional: keyboard navigation for menu
    document.addEventListener('keydown', (e)=>{
      if ((e.ctrlKey || e.metaKey) && e.key === '1') showInstrument('bdi');
      if ((e.ctrlKey || e.metaKey) && e.key === '2') showInstrument('egep');
      if ((e.ctrlKey || e.metaKey) && e.key === '3') showInstrument('amas');
      if ((e.ctrlKey || e.metaKey) && e.key === '4') showInstrument('idare');
    });
  </script>
</body>
</html>